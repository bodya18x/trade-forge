"""
Исключения для работы с Kafka.

Разделены на категории для удобной обработки ошибок.
"""

from __future__ import annotations


class TransportException(Exception):
    """Базовый класс для всех исключений tradeforge_kafka."""


# ===================================================================
# Исключения подключения и транспорта
# ===================================================================


class TimeoutError(TransportException):
    """Возникает при превышении таймаута подключения или операции."""


class AuthorizationError(TransportException):
    """
    Возникает когда клиент не авторизован для доступа к топику/брокеру/кластеру.
    """


class NoBrokersAvailable(TransportException):
    """Возникает когда ни один брокер недоступен."""


# ===================================================================
# Исключения топиков
# ===================================================================


class UnknownTopicError(TransportException):
    """Возникает когда топик не существует на брокере."""


class TopicExistsError(TransportException):
    """Возникает когда топик уже существует на брокере."""


class NewTopicError(TransportException):
    """
    Возникает при создании нового топика, когда consumer имеет старые сообщения.
    """


# ===================================================================
# Исключения сообщений
# ===================================================================


class MessageSizeError(TransportException):
    """Возникает когда размер сообщения превышает допустимый лимит."""


class MessageValidationError(TransportException):
    """
    Возникает при ошибке валидации сообщения через Pydantic.

    Это FatalError - сообщение отправляется сразу в DLQ без retry.
    """


# ===================================================================
# Исключения Consumer/Producer
# ===================================================================


class ConsumerCalledError(TransportException):
    """Возникает когда consumer уже вызван."""


class PublisherIllegalError(TransportException):
    """Возникает когда publisher закрыт принудительно."""


# ===================================================================
# Исключения для retry логики
# ===================================================================


class RetryableError(TransportException):
    """
    Временная ошибка, требующая повторной попытки.

    Примеры:
        - Сетевой таймаут
        - Временная недоступность внешнего API
        - Connection reset

    Сервис должен явно выбрасывать это исключение для retry.
    """


class FatalError(TransportException):
    """
    Постоянная ошибка, не требующая повторной попытки.

    Примеры:
        - Невалидные данные (ValidationError)
        - Запись не найдена в БД
        - Бизнес-логика упала

    Сообщение отправляется сразу в DLQ.
    """


# ===================================================================
# Исключения DLQ
# ===================================================================


class DLQSendError(TransportException):
    """Возникает при ошибке отправки сообщения в Dead Letter Queue."""


class MaxRetriesExceededError(TransportException):
    """
    Возникает когда исчерпано максимальное количество попыток обработки.

    Сообщение отправляется в DLQ.
    """
